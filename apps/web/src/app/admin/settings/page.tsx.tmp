'use client';

import React, { useState, useEffect } from 'react';
import {
    Box, Typography, Divider, Switch, Button, Chip, Alert,
    TextField, Tabs, Tab, IconButton, CircularProgress, Snackbar,
    FormControlLabel, Select, MenuItem, InputLabel, FormControl,
} from '@mui/material';
import Grid from '@mui/material/Grid';
import PaletteIcon from '@mui/icons-material/Palette';
import SecurityIcon from '@mui/icons-material/Security';
import IntegrationInstructionsIcon from '@mui/icons-material/IntegrationInstructions';
import NotificationsIcon from '@mui/icons-material/Notifications';
import KeyIcon from '@mui/icons-material/Key';
import LanguageIcon from '@mui/icons-material/Language';
import BusinessIcon from '@mui/icons-material/Business';
import SchoolIcon from '@mui/icons-material/School';
import SaveIcon from '@mui/icons-material/Save';
import RefreshIcon from '@mui/icons-material/Refresh';
import CheckCircleIcon from '@mui/icons-material/CheckCircle';
import WarningIcon from '@mui/icons-material/Warning';
import { GlassCard } from '@/shared/ui/components/GlassCard';
import { useThemeMode } from '@/shared/theme/ThemeContext';
import { getCsrfToken } from '@/lib/client-csrf';

const TEXT_COLOR = '#ffffff';
const MUTED_TEXT = 'rgba(255, 255, 255, 0.7)';
const ACCENT_COLOR = '#1dd3c5';
const PRIMARY_GRADIENT = 'linear-gradient(135deg, #00C6FF 0%, #0072FF 100%)';
const DIVIDER = 'rgba(255, 255, 255, 0.1)';

interface Settings {
    organizationName: string;
    branding: {
        primaryColor?: string;
        logoUrl?: string;
        faviconUrl?: string;
        loginBackgroundUrl?: string;
    };
    notifications: {
        emailEnabled?: boolean;
        smtpHost?: string;
        smtpPort?: number;
        smtpUser?: string;
        smtpPassword?: string;
        fromEmail?: string;
        fromName?: string;
    };
    security: {
        allowSelfRegistration?: boolean;
        requireEmailVerification?: boolean;
        passwordMinLength?: number;
        passwordRequireUppercase?: boolean;
        passwordRequireNumbers?: boolean;
        passwordRequireSpecial?: boolean;
        sessionTimeoutMinutes?: number;
        maxLoginAttempts?: number;
        lockoutDurationMinutes?: number;
        mfaEnabled?: boolean;
    };
    features: {
        enableCatalog?: boolean;
        enableSelfEnrollment?: boolean;
        enableDiscussions?: boolean;
        enableGamification?: boolean;
        enableCertificates?: boolean;
        enableLearningPaths?: boolean;
        enableSkills?: boolean;
        enableConferences?: boolean;
    };
    localization: {
        defaultLanguage?: string;
        defaultTimezone?: string;
        dateFormat?: string;
    };
}

const defaultSettings: Settings = {
    organizationName: '',
    branding: {},
    notifications: { emailEnabled: false },
    security: {
        allowSelfRegistration: true,
        requireEmailVerification: true,
        passwordMinLength: 8,
        passwordRequireUppercase: true,
        passwordRequireNumbers: true,
        passwordRequireSpecial: false,
        sessionTimeoutMinutes: 60,
        maxLoginAttempts: 5,
        lockoutDurationMinutes: 15,
        mfaEnabled: false,
    },
    features: {
        enableCatalog: true,
        enableSelfEnrollment: false,
        enableDiscussions: true,
        enableGamification: false,
        enableCertificates: true,
        enableLearningPaths: true,
        enableSkills: true,
        enableConferences: true,
    },
    localization: {
        defaultLanguage: 'en',
        defaultTimezone: 'UTC',
        dateFormat: 'MM/DD/YYYY',
    },
};

export default function SettingsPage() {
    const { mode } = useThemeMode();
    const [currentTab, setCurrentTab] = useState(0);
    const [settings, setSettings] = useState<Settings>(defaultSettings);
    const [loading, setLoading] = useState(true);
    const [saving, setSaving] = useState(false);
    const [snackbar, setSnackbar] = useState<{ open: boolean; message: string; severity: 'success' | 'error' }>({
        open: false,
        message: '',
        severity: 'success',
    });
    const [hasChanges, setHasChanges] = useState(false);

    const glassStyle = mode === 'liquid-glass' ? {
        backdropFilter: 'blur(19px) brightness(1.1) saturate(1)',
        backgroundColor: 'rgba(255, 255, 255, 0.1)',
        border: '1px solid rgba(255, 255, 255, 0.4)',
        boxShadow: 'rgba(0, 0, 0, 0.25) 0px 4px 8px',
    } : {};

    const cardStyle = {
        border: mode === 'liquid-glass' ? 'none' : `1px solid ${DIVIDER}`,
        ...(mode === 'liquid-glass' ? { ...glassStyle, borderRadius: '24px' } : {}),
    };

    useEffect(() => {
        loadSettings();
    }, []);

    const loadSettings = async () => {
        setLoading(true);
        try {
            const res = await fetch('/api/admin/settings', {
                credentials: 'include',
                headers: { 'x-csrf-token': getCsrfToken() || '' },
            });
            if (res.ok) {
                const data = await res.json();
                setSettings({
                    organizationName: data.settings?.organizationName || '',
                    branding: data.settings?.branding || {},
                    notifications: data.settings?.notifications || {},
                    security: { ...defaultSettings.security, ...data.settings?.security },
                    features: { ...defaultSettings.features, ...data.settings?.features },
                    localization: { ...defaultSettings.localization, ...data.settings?.localization },
                });
            }
        } catch (error) {
            console.error('Failed to load settings:', error);
        }
        setLoading(false);
    };

    const saveSettings = async () => {
        setSaving(true);
        try {
            const res = await fetch('/api/admin/settings', {
                method: 'POST',
                credentials: 'include',
                headers: {
                    'Content-Type': 'application/json',
                    'x-csrf-token': getCsrfToken() || '',
                },
                body: JSON.stringify({
                    organizationName: settings.organizationName,
                    branding: settings.branding,
                    notifications: settings.notifications,
                    security: settings.security,
                    features: settings.features,
                    localization: settings.localization,
                }),
            });
            if (res.ok) {
                setSnackbar({ open: true, message: 'Settings saved successfully!', severity: 'success' });
                setHasChanges(false);
            } else {
                setSnackbar({ open: true, message: 'Failed to save settings', severity: 'error' });
            }
        } catch (error) {
            setSnackbar({ open: true, message: 'Error saving settings', severity: 'error' });
        }
        setSaving(false);
    };

    const updateSetting = <K extends keyof Settings>(category: K, key: string, value: any) => {
        setSettings(prev => ({
            ...prev,
            [category]: typeof prev[category] === 'object'
                ? { ...(prev[category] as object), [key]: value }
                : value,
        }));
        setHasChanges(true);
    };

    const tabs = [
        { label: 'General', icon: <BusinessIcon /> },
        { label: 'Branding', icon: <PaletteIcon /> },
        { label: 'Security', icon: <SecurityIcon /> },
        { label: 'Features', icon: <SchoolIcon /> },
        { label: 'Notifications', icon: <NotificationsIcon /> },
        { label: 'Localization', icon: <LanguageIcon /> },
    ];

    if (loading) {
        return (
            <Box sx={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '50vh' }}>
                <CircularProgress sx={{ color: ACCENT_COLOR }} />
            </Box>
        );
    }

    return (
        <Box>
            {/* Header */}
            <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 4 }}>
                <Box>
                    <Typography variant="h4" sx={{
                        fontWeight: 800,
                        color: TEXT_COLOR,
                        mb: 1,
                        background: 'linear-gradient(45deg, #fff 30%, #1dd3c5 90%)',
                        WebkitBackgroundClip: 'text',
                        WebkitTextFillColor: 'transparent',
                    }}>
                        Settings
                    </Typography>
                    <Typography variant="body1" sx={{ color: MUTED_TEXT }}>
                        Configure your LMS platform settings
                    </Typography>
                </Box>
                <Box sx={{ display: 'flex', gap: 2 }}>
                    <Button
                        variant="outlined"
                        startIcon={<RefreshIcon />}
                        onClick={loadSettings}
                        sx={{
                            color: TEXT_COLOR,
                            borderColor: DIVIDER,
                            '&:hover': { borderColor: ACCENT_COLOR }
                        }}
                    >
                        Reload
                    </Button>
                    <Button
                        variant="contained"
                        startIcon={saving ? <CircularProgress size={20} color="inherit" /> : <SaveIcon />}
                        onClick={saveSettings}
                        disabled={saving || !hasChanges}
                        sx={{
                            background: PRIMARY_GRADIENT,
                            color: '#fff',
                            fontWeight: 700,
                            px: 3,
                            '&:disabled': { opacity: 0.5 }
                        }}
                    >
                        {saving ? 'Saving...' : 'Save Changes'}
                    </Button>
                </Box>
            </Box>

            {hasChanges && (
                <Alert severity="warning" sx={{ mb: 3, bgcolor: 'rgba(255, 152, 0, 0.1)', color: TEXT_COLOR }}>
                    You have unsaved changes. Don't forget to save before leaving.
                </Alert>
            )}

            {/* Tabs */}
            <GlassCard sx={{ ...cardStyle, mb: 3 }}>
                <Tabs
                    value={currentTab}
                    onChange={(_, v) => setCurrentTab(v)}
                    sx={{
                        px: 2,
                        '& .MuiTabs-indicator': { bgcolor: ACCENT_COLOR },
                        '& .MuiTab-root': { color: MUTED_TEXT, textTransform: 'none', fontWeight: 600 },
                        '& .Mui-selected': { color: TEXT_COLOR },
                    }}
                >
                    {tabs.map((tab, i) => (
                        <Tab key={i} label={tab.label} icon={tab.icon} iconPosition="start" />
                    ))}
                </Tabs>
            </GlassCard>

            {/* Tab Content */}
            <GlassCard sx={{ ...cardStyle, p: 3 }}>
                {/* General Tab */}
                {currentTab === 0 && (
                    <Box>
                        <Typography variant="h6" sx={{ color: TEXT_COLOR, fontWeight: 700, mb: 3 }}>
                            General Settings
                        </Typography>
                        <Grid container spacing={3}>
                            <Grid size={{ xs: {12} md={6}>
                                <TextField
                                    fullWidth
                                    label="Organization Name"
                                    value={settings.organizationName}
                                    onChange={(e) => {
                                        setSettings(prev => ({ ...prev, organizationName: e.target.value }));
                                        setHasChanges(true);
                                    }}
                                    sx={textFieldStyle}
                                />
                            </Grid>
                        </Grid>
                    </Box>
                )}

                {/* Branding Tab */}
                {currentTab === 1 && (
                    <Box>
                        <Typography variant="h6" sx={{ color: TEXT_COLOR, fontWeight: 700, mb: 3 }}>
                            Branding Settings
                        </Typography>
                        <Grid container spacing={3}>
                            <Grid size={{ xs: {12} md={6}>
                                <TextField
                                    fullWidth
                                    label="Primary Color"
                                    type="color"
                                    value={settings.branding.primaryColor || '#1dd3c5'}
                                    onChange={(e) => updateSetting('branding', 'primaryColor', e.target.value)}
                                    sx={textFieldStyle}
                                    InputProps={{ sx: { height: 56 } }}
                                />
                            </Grid>
                            <Grid size={{ xs: {12} md={6}>
                                <TextField
                                    fullWidth
                                    label="Logo URL"
                                    value={settings.branding.logoUrl || ''}
                                    onChange={(e) => updateSetting('branding', 'logoUrl', e.target.value)}
                                    sx={textFieldStyle}
                                    placeholder="https://..."
                                />
                            </Grid>
                            <Grid size={{ xs: {12} md={6}>
                                <TextField
                                    fullWidth
                                    label="Favicon URL"
                                    value={settings.branding.faviconUrl || ''}
                                    onChange={(e) => updateSetting('branding', 'faviconUrl', e.target.value)}
                                    sx={textFieldStyle}
                                    placeholder="https://..."
                                />
                            </Grid>
                            <Grid size={{ xs: {12} md={6}>
                                <TextField
                                    fullWidth
                                    label="Login Background URL"
                                    value={settings.branding.loginBackgroundUrl || ''}
                                    onChange={(e) => updateSetting('branding', 'loginBackgroundUrl', e.target.value)}
                                    sx={textFieldStyle}
                                    placeholder="https://..."
                                />
                            </Grid>
                        </Grid>
                    </Box>
                )}

                {/* Security Tab */}
                {currentTab === 2 && (
                    <Box>
                        <Typography variant="h6" sx={{ color: TEXT_COLOR, fontWeight: 700, mb: 3 }}>
                            Security Settings
                        </Typography>
                        <Grid container spacing={3}>
                            {/* Toggle Settings */}
                            <Grid size={{ xs: {12}>
                                <Typography variant="subtitle2" sx={{ color: MUTED_TEXT, mb: 2 }}>
                                    Registration & Authentication
                                </Typography>
                                <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 2 }}>
                                    {[
                                        { key: 'allowSelfRegistration', label: 'Allow Self Registration' },
                                        { key: 'requireEmailVerification', label: 'Require Email Verification' },
                                        { key: 'mfaEnabled', label: 'Enable Two-Factor Authentication' },
                                    ].map(item => (
                                        <Box key={item.key} sx={toggleBoxStyle}>
                                            <Typography variant="body2" sx={{ color: TEXT_COLOR }}>{item.label}</Typography>
                                            <Switch
                                                checked={settings.security[item.key as keyof typeof settings.security] as boolean || false}
                                                onChange={(e) => updateSetting('security', item.key, e.target.checked)}
                                                sx={switchStyle}
                                            />
                                        </Box>
                                    ))}
                                </Box>
                            </Grid>

                            {/* Password Policy */}
                            <Grid size={{ xs: {12}>
                                <Typography variant="subtitle2" sx={{ color: MUTED_TEXT, mb: 2, mt: 2 }}>
                                    Password Policy
                                </Typography>
                            </Grid>
                            <Grid size={{ xs: {12} md={4}>
                                <TextField
                                    fullWidth
                                    label="Minimum Password Length"
                                    type="number"
                                    value={settings.security.passwordMinLength || 8}
                                    onChange={(e) => updateSetting('security', 'passwordMinLength', parseInt(e.target.value))}
                                    sx={textFieldStyle}
                                />
                            </Grid>
                            <Grid size={{ xs: {12}>
                                <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 2 }}>
                                    {[
                                        { key: 'passwordRequireUppercase', label: 'Require Uppercase' },
                                        { key: 'passwordRequireNumbers', label: 'Require Numbers' },
                                        { key: 'passwordRequireSpecial', label: 'Require Special Characters' },
                                    ].map(item => (
                                        <Box key={item.key} sx={toggleBoxStyle}>
                                            <Typography variant="body2" sx={{ color: TEXT_COLOR }}>{item.label}</Typography>
                                            <Switch
                                                checked={settings.security[item.key as keyof typeof settings.security] as boolean || false}
                                                onChange={(e) => updateSetting('security', item.key, e.target.checked)}
                                                sx={switchStyle}
                                            />
                                        </Box>
                                    ))}
                                </Box>
                            </Grid>

                            {/* Session Settings */}
                            <Grid size={{ xs: {12}>
                                <Typography variant="subtitle2" sx={{ color: MUTED_TEXT, mb: 2, mt: 2 }}>
                                    Session & Lockout
                                </Typography>
                            </Grid>
                            <Grid size={{ xs: {12} md={4}>
                                <TextField
                                    fullWidth
                                    label="Session Timeout (minutes)"
                                    type="number"
                                    value={settings.security.sessionTimeoutMinutes || 60}
                                    onChange={(e) => updateSetting('security', 'sessionTimeoutMinutes', parseInt(e.target.value))}
                                    sx={textFieldStyle}
                                />
                            </Grid>
                            <Grid size={{ xs: {12} md={4}>
                                <TextField
                                    fullWidth
                                    label="Max Login Attempts"
                                    type="number"
                                    value={settings.security.maxLoginAttempts || 5}
                                    onChange={(e) => updateSetting('security', 'maxLoginAttempts', parseInt(e.target.value))}
                                    sx={textFieldStyle}
                                />
                            </Grid>
                            <Grid size={{ xs: {12} md={4}>
                                <TextField
                                    fullWidth
                                    label="Lockout Duration (minutes)"
                                    type="number"
                                    value={settings.security.lockoutDurationMinutes || 15}
                                    onChange={(e) => updateSetting('security', 'lockoutDurationMinutes', parseInt(e.target.value))}
                                    sx={textFieldStyle}
                                />
                            </Grid>
                        </Grid>
                    </Box>
                )}

                {/* Features Tab */}
                {currentTab === 3 && (
                    <Box>
                        <Typography variant="h6" sx={{ color: TEXT_COLOR, fontWeight: 700, mb: 3 }}>
                            Feature Toggles
                        </Typography>
                        <Typography variant="body2" sx={{ color: MUTED_TEXT, mb: 3 }}>
                            Enable or disable features across your LMS platform.
                        </Typography>
                        <Grid container spacing={2}>
                            {[
                                { key: 'enableCatalog', label: 'Course Catalog', description: 'Allow users to browse available courses' },
                                { key: 'enableSelfEnrollment', label: 'Self Enrollment', description: 'Allow users to enroll themselves in courses' },
                                { key: 'enableDiscussions', label: 'Discussions', description: 'Enable course and group discussions' },
                                { key: 'enableGamification', label: 'Gamification', description: 'Points, badges, and leaderboards' },
                                { key: 'enableCertificates', label: 'Certificates', description: 'Issue certificates on course completion' },
                                { key: 'enableLearningPaths', label: 'Learning Paths', description: 'Create structured learning journeys' },
                                { key: 'enableSkills', label: 'Skills', description: 'Track and assign skills to users' },
                                { key: 'enableConferences', label: 'Conferences', description: 'Video conferencing integration' },
                            ].map(feature => (
                                <Grid size={{ xs: {12} sm={6} md={4} key={feature.key}>
                                    <Box sx={{
                                        p: 2,
                                        borderRadius: 2,
                                        bgcolor: 'rgba(255, 255, 255, 0.05)',
                                        border: `1px solid ${DIVIDER}`,
                                        display: 'flex',
                                        justifyContent: 'space-between',
                                        alignItems: 'flex-start',
                                    }}>
                                        <Box>
                                            <Typography variant="body1" sx={{ color: TEXT_COLOR, fontWeight: 600 }}>
                                                {feature.label}
                                            </Typography>
                                            <Typography variant="caption" sx={{ color: MUTED_TEXT }}>
                                                {feature.description}
                                            </Typography>
                                        </Box>
                                        <Switch
                                            checked={settings.features[feature.key as keyof typeof settings.features] as boolean || false}
                                            onChange={(e) => updateSetting('features', feature.key, e.target.checked)}
                                            sx={switchStyle}
                                        />
                                    </Box>
                                </Grid>
                            ))}
                        </Grid>
                    </Box>
                )}

                {/* Notifications Tab */}
                {currentTab === 4 && (
                    <Box>
                        <Typography variant="h6" sx={{ color: TEXT_COLOR, fontWeight: 700, mb: 3 }}>
                            Email Notifications
                        </Typography>
                        <Grid container spacing={3}>
                            <Grid size={{ xs: {12}>
                                <Box sx={toggleBoxStyle}>
                                    <Typography variant="body2" sx={{ color: TEXT_COLOR }}>Enable Email Notifications</Typography>
                                    <Switch
                                        checked={settings.notifications.emailEnabled || false}
                                        onChange={(e) => updateSetting('notifications', 'emailEnabled', e.target.checked)}
                                        sx={switchStyle}
                                    />
                                </Box>
                            </Grid>

                            {settings.notifications.emailEnabled && (
                                <>
                                    <Grid size={{ xs: {12}>
                                        <Typography variant="subtitle2" sx={{ color: MUTED_TEXT, mb: 2 }}>
                                            SMTP Configuration
                                        </Typography>
                                    </Grid>
                                    <Grid size={{ xs: {12} md={6}>
                                        <TextField
                                            fullWidth
                                            label="SMTP Host"
                                            value={settings.notifications.smtpHost || ''}
                                            onChange={(e) => updateSetting('notifications', 'smtpHost', e.target.value)}
                                            sx={textFieldStyle}
                                            placeholder="smtp.example.com"
                                        />
                                    </Grid>
                                    <Grid size={{ xs: {12} md={6}>
                                        <TextField
                                            fullWidth
                                            label="SMTP Port"
                                            type="number"
                                            value={settings.notifications.smtpPort || 587}
                                            onChange={(e) => updateSetting('notifications', 'smtpPort', parseInt(e.target.value))}
                                            sx={textFieldStyle}
                                        />
                                    </Grid>
                                    <Grid size={{ xs: {12} md={6}>
                                        <TextField
                                            fullWidth
                                            label="SMTP Username"
                                            value={settings.notifications.smtpUser || ''}
                                            onChange={(e) => updateSetting('notifications', 'smtpUser', e.target.value)}
                                            sx={textFieldStyle}
                                        />
                                    </Grid>
                                    <Grid size={{ xs: {12} md={6}>
                                        <TextField
                                            fullWidth
                                            label="SMTP Password"
                                            type="password"
                                            value={settings.notifications.smtpPassword || ''}
                                            onChange={(e) => updateSetting('notifications', 'smtpPassword', e.target.value)}
                                            sx={textFieldStyle}
                                        />
                                    </Grid>
                                    <Grid size={{ xs: {12} md={6}>
                                        <TextField
                                            fullWidth
                                            label="From Email"
                                            value={settings.notifications.fromEmail || ''}
                                            onChange={(e) => updateSetting('notifications', 'fromEmail', e.target.value)}
                                            sx={textFieldStyle}
                                            placeholder="noreply@example.com"
                                        />
                                    </Grid>
                                    <Grid size={{ xs: {12} md={6}>
                                        <TextField
                                            fullWidth
                                            label="From Name"
                                            value={settings.notifications.fromName || ''}
                                            onChange={(e) => updateSetting('notifications', 'fromName', e.target.value)}
                                            sx={textFieldStyle}
                                            placeholder="LMS Notifications"
                                        />
                                    </Grid>
                                </>
                            )}
                        </Grid>
                    </Box>
                )}

                {/* Localization Tab */}
                {currentTab === 5 && (
                    <Box>
                        <Typography variant="h6" sx={{ color: TEXT_COLOR, fontWeight: 700, mb: 3 }}>
                            Localization Settings
                        </Typography>
                        <Grid container spacing={3}>
                            <Grid size={{ xs: {12} md={4}>
                                <FormControl fullWidth sx={textFieldStyle}>
                                    <InputLabel sx={{ color: MUTED_TEXT }}>Default Language</InputLabel>
                                    <Select
                                        value={settings.localization.defaultLanguage || 'en'}
                                        label="Default Language"
                                        onChange={(e) => updateSetting('localization', 'defaultLanguage', e.target.value)}
                                        sx={{ color: TEXT_COLOR }}
                                    >
                                        <MenuItem value="en">English</MenuItem>
                                        <MenuItem value="es">Spanish</MenuItem>
                                        <MenuItem value="fr">French</MenuItem>
                                        <MenuItem value="de">German</MenuItem>
                                        <MenuItem value="ar">Arabic</MenuItem>
                                        <MenuItem value="zh">Chinese</MenuItem>
                                    </Select>
                                </FormControl>
                            </Grid>
                            <Grid size={{ xs: {12} md={4}>
                                <FormControl fullWidth sx={textFieldStyle}>
                                    <InputLabel sx={{ color: MUTED_TEXT }}>Default Timezone</InputLabel>
                                    <Select
                                        value={settings.localization.defaultTimezone || 'UTC'}
                                        label="Default Timezone"
                                        onChange={(e) => updateSetting('localization', 'defaultTimezone', e.target.value)}
                                        sx={{ color: TEXT_COLOR }}
                                    >
                                        <MenuItem value="UTC">UTC</MenuItem>
                                        <MenuItem value="America/New_York">Eastern Time (US)</MenuItem>
                                        <MenuItem value="America/Los_Angeles">Pacific Time (US)</MenuItem>
                                        <MenuItem value="Europe/London">London</MenuItem>
                                        <MenuItem value="Europe/Paris">Paris</MenuItem>
                                        <MenuItem value="Asia/Dubai">Dubai</MenuItem>
                                        <MenuItem value="Asia/Tokyo">Tokyo</MenuItem>
                                    </Select>
                                </FormControl>
                            </Grid>
                            <Grid size={{ xs: {12} md={4}>
                                <FormControl fullWidth sx={textFieldStyle}>
                                    <InputLabel sx={{ color: MUTED_TEXT }}>Date Format</InputLabel>
                                    <Select
                                        value={settings.localization.dateFormat || 'MM/DD/YYYY'}
                                        label="Date Format"
                                        onChange={(e) => updateSetting('localization', 'dateFormat', e.target.value)}
                                        sx={{ color: TEXT_COLOR }}
                                    >
                                        <MenuItem value="MM/DD/YYYY">MM/DD/YYYY</MenuItem>
                                        <MenuItem value="DD/MM/YYYY">DD/MM/YYYY</MenuItem>
                                        <MenuItem value="YYYY-MM-DD">YYYY-MM-DD</MenuItem>
                                    </Select>
                                </FormControl>
                            </Grid>
                        </Grid>
                    </Box>
                )}
            </GlassCard>

            {/* Snackbar */}
            <Snackbar
                open={snackbar.open}
                autoHideDuration={4000}
                onClose={() => setSnackbar(prev => ({ ...prev, open: false }))}
                message={snackbar.message}
            />
        </Box>
    );
}

// Styles
const textFieldStyle = {
    '& .MuiOutlinedInput-root': {
        color: '#fff',
        '& fieldset': { borderColor: 'rgba(255, 255, 255, 0.2)' },
        '&:hover fieldset': { borderColor: 'rgba(255, 255, 255, 0.4)' },
        '&.Mui-focused fieldset': { borderColor: '#1dd3c5' },
    },
    '& .MuiInputLabel-root': { color: 'rgba(255, 255, 255, 0.7)' },
    '& .MuiInputLabel-root.Mui-focused': { color: '#1dd3c5' },
};

const switchStyle = {
    '& .MuiSwitch-switchBase.Mui-checked': {
        color: '#1dd3c5',
    },
    '& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track': {
        bgcolor: '#1dd3c5',
    },
};

const toggleBoxStyle = {
    display: 'flex',
    justifyContent: 'space-between',
    alignItems: 'center',
    p: 1.5,
    bgcolor: 'rgba(255, 255, 255, 0.05)',
    borderRadius: 1.5,
    border: '1px solid rgba(255, 255, 255, 0.1)',
    minWidth: 200,
};
